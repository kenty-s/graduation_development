<div class="max-w-6xl mx-auto px-4 py-10 space-y-8">
  <div class="text-center space-y-2">
    <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">条件で検索</h1>
    <p class="text-sm text-gray-500">各項目は1つまで選択できます（未選択でもOK）</p>
  </div>

  <% categories      = ['ガッツリ', 'サッパリ'] %>
  <% time_of_days    = ['朝', '昼', '夜', 'おやつ'] %>
  <% seasons         = ['春', '夏', '秋', '冬'] %>
  <% genres          = ['和食', '洋食', '中華', 'エスニック', 'その他'] %>
  <% spices          = ['ブラックペッパー', 'ガーリック', '生姜', '唐辛子', 'クミン', 'コリアンダー', 'ターメリック', 'パプリカ', 'オレガノ', 'ローズマリー', 'タイム', 'パセリ', 'ローレル', 'ナツメグ', 'クローブ', '山椒', 'カルダモン', 'シナモン', 'バジル', '五香粉'] %>
  <% common_option_classes = "rounded-xl px-4 py-3 text-center border border-gray-300 bg-white text-gray-700 shadow-sm transition hover:shadow-md hover:border-gray-400 peer-checked:border-orange-500 peer-checked:bg-orange-50 peer-checked:text-orange-700 peer-checked:shadow peer-checked:ring-2 peer-checked:ring-orange-200 min-h-[3.25rem] flex items-center justify-center" %>
  <% section_card_classes  = "space-y-3 rounded-2xl border border-gray-200 bg-white p-5 shadow-sm" %>
  <% section_title_classes = "text-lg font-semibold text-gray-800" %>
  <% section_badge_classes = "inline-flex items-center rounded-full bg-amber-100 px-3 py-1 text-xs font-semibold text-amber-800" %>
  <% option_text_classes   = "font-medium peer-checked:font-semibold" %>

  <%= form_with url: advanced_search_path, method: :get, local: true, data: { turbo: false }, class: "space-y-6" do |f| %>
    <div class="<%= section_card_classes %>">
      <div class="flex items-center gap-3">
        <span class="<%= section_title_classes %>">カテゴリ</span>
        <span class="<%= section_badge_classes %>">1つまで</span>
      </div>
      <div class="grid grid-cols-2 gap-3">
        <% categories.each do |cat| %>
          <label class="cursor-pointer">
            <%= f.radio_button :category, cat, class: "hidden peer" %>
            <div class="<%= common_option_classes %>">
              <span class="<%= option_text_classes %>"><%= cat %></span>
            </div>
          </label>
        <% end %>
      </div>
    </div>

    <div class="<%= section_card_classes %>">
      <div class="flex items-center gap-3">
        <span class="<%= section_title_classes %>">時間帯</span>
        <span class="<%= section_badge_classes %>">1つまで</span>
      </div>
      <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
        <% time_of_days.each do |t| %>
          <label class="cursor-pointer">
            <%= f.radio_button :time_of_day, t, class: "hidden peer" %>
            <div class="<%= common_option_classes %>">
              <span class="<%= option_text_classes %>"><%= t %></span>
            </div>
          </label>
        <% end %>
      </div>
    </div>

    <div class="<%= section_card_classes %>">
      <div class="flex items-center gap-3">
        <span class="<%= section_title_classes %>">季節感</span>
        <span class="<%= section_badge_classes %>">1つまで</span>
      </div>
      <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
        <% seasons.each do |s| %>
          <label class="cursor-pointer">
            <%= f.radio_button :season, s, class: "hidden peer" %>
            <div class="<%= common_option_classes %>">
              <span class="<%= option_text_classes %>"><%= s %></span>
            </div>
          </label>
        <% end %>
      </div>
    </div>

    <div class="<%= section_card_classes %>">
      <div class="flex items-center gap-3">
        <span class="<%= section_title_classes %>">ジャンル</span>
        <span class="<%= section_badge_classes %>">1つまで</span>
      </div>
      <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
        <% genres.each do |g| %>
          <label class="cursor-pointer">
            <%= f.radio_button :genre, g, class: "hidden peer" %>
            <div class="<%= common_option_classes %>">
              <span class="<%= option_text_classes %>"><%= g %></span>
            </div>
          </label>
        <% end %>
      </div>
    </div>

    <div class="<%= section_card_classes %>">
      <div class="flex items-center gap-3">
        <span class="<%= section_title_classes %>">スパイス/ハーブ</span>
        <span class="<%= section_badge_classes %>">1つまで</span>
      </div>
      <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
        <% spices.each do |spice| %>
          <label class="cursor-pointer">
            <%= f.radio_button :spice_name, spice, class: "hidden peer" %>
            <div class="<%= common_option_classes %>">
              <span class="<%= option_text_classes %>"><%= spice %></span>
            </div>
          </label>
        <% end %>
      </div>
    </div>
    <div class="flex gap-4 pt-4">
      <%= f.submit "条件で検索する", class: "flex-1 py-3 px-4 bg-orange-500 text-white font-bold rounded-lg shadow hover:bg-orange-600 transition" %>
      <%= link_to "クリア", advanced_search_path, class: "py-3 px-4 bg-white text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition" %>
    </div>
  <% end %>
</div>

<script>
  (() => {
    const bindToggleRadios = () => {
      document.querySelectorAll("label.cursor-pointer").forEach((label) => {
        const input = label.querySelector('input[type="radio"]');
        if (!input) return;
        if (input.dataset.toggleBound === "true") return;

        input.dataset.toggleBound = "true";
        label.addEventListener("pointerdown", () => {
          input.dataset.wasChecked = input.checked ? "true" : "false";
        });
        label.addEventListener("click", () => {
          if (input.dataset.wasChecked === "true") {
            input.checked = false;
          }
        });
      });
    };

    document.addEventListener("turbo:load", bindToggleRadios);
    document.addEventListener("DOMContentLoaded", bindToggleRadios);
    bindToggleRadios();
  })();
</script>
